

{% extends "base_template_sincal.html" %}

{% block title %}PAgina inicio logueado{% endblock %}

{% block content2 %}

        <div class="col py-3">


            <h2>Listado de gastos</h2>
            <p class="lead">

                <div class="table-responsive" id="listaGastos">
                    <table class="table table-striped table-sm">
                      <thead>
                        <tr>
                            <th scope="col">Fecha</th>
                            <th scope="col">Razon social</th>
                            <th scope="col">Importe</th>
                            <th scope="col">IVA</th>
                            <th scope="col">Cif</th>
                            <th scope="col">numeroTicket</th>
                            <th scope="col">Foto</th>
                            <th scope="col">Validado</th>
                        </tr>
                       </thead>  
                       <tbody>                                    
                        {% for ticket in listaGastos %}
                           <tr>
                               <td>{{ticket.fecha}}</td>
                               <td>{{ticket.razonSocial}}</td>
                               <td>{{ticket.importe}}</td>
                               <td>{{ticket.iva}}</td>
                               <td>{{ticket.cif}}</td>
                               <td>{{ticket.numeroTicket}}</td>
                               <!--<td><img id="image-modal" src="{{ url_for("usuarios_blueprint.cargaTicket", idGasto=ticket.idGasto) }}"
                                    style="max-width:50px" data-target="#myModal" data-toggle="modal"></td> -->
                                <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"
                                        data-gasto={{ ticket.idGasto }}><i class="bi-file-earmark-text"></i></button></td>
                                {% if ticket.validado == True %}
                                    <td><button type="button" class="btn btn-primary" id="valida" data-gasto={{ ticket.idGasto }}
                                        onclick="window.location.href='{{ url_for('usuarios_blueprint.validaTicket', idGasto=ticket.idGasto) }}';">
                                        <i class="bi-check"></i></button></td>
                                {% else %}
                                    <td><button type="button" class="btn btn-secondary" id="valida" data-gasto={{ ticket.idGasto }}
                                        onclick="window.location.href='{{ url_for('usuarios_blueprint.validaTicket', idGasto=ticket.idGasto) }}';">
                                        <i class="bi-x"></i></button></td>
                                {% endif %}
                            </tr>
                        {% endfor %}   
                        </tbody>
                    </ttable>
                </div>


                    <div id="myModal" class="modal fade" role="dialog" tabindex="-1" aria-labelledby="exModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document" >
                            <div class="modal-content">
                                <div class="modal-body" style="width:500px; height:500px">
                                    <img src="" id="showing" style="width:100%; height:480px"/>
                                </div>
                                <div class="modal-footer">
                                    </div>
                          
                                </div>
                            </div>
                        </div>
                    </div>
                
            <!-- Esta parte no la necesito porque estoy haciendo la validacion en el evento onclick del boton     
                    <script type="text/javascript">
                        const btnValida = document.querySelectorAll("#valida");

                        const validaClick = function (evento) {
                            
                            //console.log("boton pulsado tiene: ", this.dataset.gasto );
                            
                            var idGastoTabla = this.dataset.gasto;
                            //jQuery('myModal').on('show.bs.modal', function(e) {
                                //var img = $(e.relatedTarget).attr('src');
                                console.log('idGastoParametroValida:', idGastoTabla);
                                "{{ url_for('usuarios_blueprint.validaTicket', idGasto='var') }}".replace("var", idGastoTabla)
                               
                                console.log('url:', img);
                                //No coge el idGastoTabla y se lo tengo que añadir aqui.
                                //jQuery('#showing').attr('src', img+idGastoTabla);
                            //});
                            //jQuery('myModal').modal("show");
                        }
                        btnValida.forEach(valida => {    
                            valida.addEventListener("click", validaClick);
                        });
                    </script>
                -->

                <!-- Este script muestra en una modal el ticket -->
                    <script type="text/javascript">
                        const botones = document.querySelectorAll(".btn-primary");

                        const haceClick = function (evento) {
                            
                            //console.log("boton pulsado tiene: ", this.dataset.gasto );
                            
                            var idGastoTabla = this.dataset.gasto;
                            //jQuery('myModal').on('show.bs.modal', function(e) {
                                //var img = $(e.relatedTarget).attr('src');
                                console.log('idGastoParametro:', idGastoTabla);
                                img = "{{ url_for('usuarios_blueprint.cargaTicket', idGasto=idGastoTabla) }}"
                                //No coge el idGastoTabla y se lo tengo que añadir aqui.
                                jQuery('#showing').attr('src', img+idGastoTabla);
                            //});
                            jQuery('myModal').modal("show");
                        }
                        //añadimos un controlador de eventos por cada boton
                        botones.forEach(boton => {    
                            boton.addEventListener("click", haceClick);
                        });
                    </script>

            </p>
        </div>

    </div>

{% endblock %}











