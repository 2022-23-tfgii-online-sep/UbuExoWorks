

{% extends "base_template.html" %}

{% block title %}Listado de usuarios de la emrpesa{% endblock %}

{% block content2 %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"/>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/bootstrap-table.min.css">-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/bootstrap-table.min.css" 
    integrity="sha512-63GnyqfeNhRXT6e2IHxrE9pCY+1ruclRMhzsWk7U5NKBlV/dOdioucXKvDoMrAAIpdKUzqhBYSB2eLnogoWP4g==" 
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://rawgit.com/vitalets/x-editable/master/dist/bootstrap3-editable/css/bootstrap-editable.css">

<link rel='stylesheet' type='text/css' href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.2/main.min.css'/>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.2/main.min.js"></script>


        <div class="col py-3">
            <!-- Si es un usuario Administrador del sistema damos la opcion de cambiar la empresa que se esta gestionando -->
            {%if current_user.is_admin() == True  %}
                <h2>{{ empresa }}</h2><a href="/admin">Cambia empresa</a>
            {% else %}
                <h2>{{ empresa }}</h2>
            {% endif %}
            <h2>Listado de usuarios</h2>
            <p class="lead">

                <div class="table-responsive">
                        <table class="table table-striped table-sm" id="tablaEmpleados" aria-describedby="tablaListadoUsuarios"
                        data-togle="table"
                        data-search="true"
                        data-filter-control="true"
                        data-show-export="true"
                        data-click-to-select="true"
                        data-toolbar="#toolbar">
                      <thead>
                        <tr>
                            <th data-field="id" data-filter-control="input" data-sortable="true">Id</th>
                            <th data-field="nombre" data-filter-control="input" data-sortable="true">Nombre</th>
                            <th data-field="apellidos" data-filter-control="input" data-sortable="true">Apellidos</th>
                            <th data-field="email" data-filter-control="input" data-sortable="true">Email</th>
                            <th data-field="nif" data-filter-control="input" data-sortable="true">NIF</th>
                            <th data-field="rol" data-filter-control="input" data-sortable="true">Rol</th>
                            <th data-field="estado" data-sortable="true">Estado</th>
                            <th data-field="gastos" data-sortable="true">Gastos</th>
                            <th data-field="fichajes" data-sortable="true">Fichajes</th>
                            <th data-field="modificar" data-sortable="true">Modificar</th>
                        </tr>
                       </thead>  
                    </table>

                </div>

                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js" integrity="sha512-n/4gHW3atM3QqRcbCn6ewmpxcLAHGaDjpEBu4xZd47N0W2oQ+6q7oc3PXstrJYXcbNU1OHdQ1T7pAP+gi5Yu8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                
                <script type="text/javascript" src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
                
                <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
                
                <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
                
                
                
                <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/bootstrap-table.js"></script>-->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.0/bootstrap-table.js" 
                    integrity="sha512-8uxY/YCNhC7O+ZXitcFjbt1FFC4g7LCGE6uCSxR5MYl2TA9qUKdNUUMoINpBb7O0/Bc8590O8n9zktib1fMiHA==" 
                    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

                <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/extensions/editable/bootstrap-table-editable.js"></script>-->
                <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/extensions/export/bootstrap-table-export.js"></script>-->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/extensions/export/bootstrap-table-export.min.js" 
                    integrity="sha512-B10O3fjdFvKIH2+I1HoNRzhU3PG5lttxH0twDC5/5DpuFesgVEoSOrlPHX7HomSnPhmeO10GXJj6rLmqlejE0w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
               <!-- <script type="text/javascript" src="https://rawgit.com/hhurz/tableExport.jquery.plugin/master/tableExport.js"></script>-->
                <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/extensions/filter-control/bootstrap-table-filter-control.js"></script>-->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.1/extensions/filter-control/bootstrap-table-filter-control.js" 
                    integrity="sha512-T1Eqdlhk26VUvNaUxFAnoIoLZXNKq1w92qGhp+6Xx/glOAMRSIihOPz00+779RBZrecpx49PFSfRgK0C+9upwQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                
                


                <script type="text/javascript" nonce="2726c7f26c">
                    var parametros = new window.URLSearchParams(window.location.search);    
                    var idUsuario = parametros.get('idUsuario');
                    console.log('idUsuario cargado: ',idUsuario);
                    var fecha_actual = new Date();
                    var strFecha_actual = fecha_actual.getFullYear() + "/" + (fecha_actual.getMonth()+1) + "/" + fecha_actual.getDate();
                    
                    url_home = "{{ url_for('usuarios_blueprint.usuariosEmpresaAjax') }}";
                    console.log('url carga:', url_home);


                    var table = $('#tablaEmpleados').DataTable
                    ({
                        language: {
                            "decimal": "",
                            "emptyTable": "No hay informaci√≥n",
                            "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                            "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                            "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                            "infoPostFix": "",
                            "thousands": ",",
                            "lengthMenu": "Mostrar _MENU_ Entradas",
                            "loadingRecords": "Cargando...",
                            "processing": "Procesando...",
                            "search": "Buscar:",
                            "zeroRecords": "Sin resultados encontrados",
                            "paginate": {
                                "first": "Primero",
                                "last": "Ultimo",
                                "next": "Siguiente",
                                "previous": "Anterior"
                            }
                        },

                        "ajax": {
                            "method": "POST",
                            "url": url_home,
                            "data": null
                        },
                        "columns": [
                            {"data":"id"},
                            {"data":"nombre"},
                            {"data":"apellidos"},
                            {"data":"email"},
                            {"data":"nif"},
                            {"data":"rol"},
                            {"data":"estado"},
                            {"data": "gastos",
                             "render": function(data, type, row) {
                                return "<button type='button' class='btn btn-primary' id='botonGastos' data-id="+row['id']+" >Gastos</button>"
                                }
                            },
                            {"data": "fichajes",
                             "render": function(data, type, row) {
                                return "<button type='button' class='btn btn-primary' id='botonFichajes' data-id="+row['id']+" >Fichajes</button>"
                                }
                            },
                            {"data": "modificacion",
                             "render": function(data, type, row) {
                                return "<button type='button' class='btn btn-primary' id='botonModificar' data-id="+row['id']+" >Modificar</button>"
                                }
                            }
                        ]
                    });

                    $('#tablaEmpleados tbody').on('click', '#botonGastos', function () {
                        
                        console.log("gastos pulsado tiene el id de usuario: ", this.dataset.id);
                        var id = this.dataset.id;

                        window.location.href = "{{ url_for('usuarios_blueprint.usuarioGastos') }}" + "?idUsuario=" + id;
                    });

                    $('#tablaEmpleados tbody').on('click', '#botonFichajes', function () {
                        
                        console.log("fichajes pulsado tiene el id de usuario: ", this.dataset.id);
                        var id = this.dataset.id;

                        window.location.href = "{{ url_for('usuarios_blueprint.usuarioFichajes') }}" + "?idUsuario=" + id;
                        
                    });

                    $('#tablaEmpleados tbody').on('click', '#botonModificar', function () {
                        
                        console.log("modificar pulsado tiene el id de usuario: ", this.dataset.id);
                        var id = this.dataset.id;

                        window.location.href = "{{ url_for('usuarios_blueprint.modifica_usuario') }}" + "?idUsuario=" + id;
                    });

                </script>

            </p>
        </div>

    </div>

{% endblock %}

